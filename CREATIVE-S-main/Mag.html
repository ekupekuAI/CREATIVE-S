<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Magazine Generator — College Magazine Builder</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: linear-gradient(180deg,#f8fafc, #eef2ff); }
    .card-hero { border-radius: 1rem; box-shadow: 0 8px 30px rgba(49,49,93,0.08);} 
    .mag-preview { background: white; padding: 2rem; border-radius: .75rem; min-height: 420px; }
    .cover-title { font-family: 'Georgia', serif; font-size: 2.25rem; letter-spacing: .6px; }
    .template-badge { font-size: .8rem; }
    .article-image { max-width: 100%; height: auto; border-radius: 6px; }
    .pull-quote { font-size: 1.1rem; font-weight: 700; }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="row g-4">
      <div class="col-lg-5">
        <div class="card card-hero p-4">
          <h3 class="mb-3">AI Magazine Generator — Text + Layout</h3>
          <p class="text-muted">Fill the form below and click <strong>Generate</strong>. The app will build magazine-ready text, captions, and a styled preview. To enable AI text generation, add your OpenAI API key in settings.</p>

          <form id="magForm">
            <div class="mb-2">
              <label class="form-label">Magazine Title</label>
              <input class="form-control" id="magTitle" placeholder="The Campus Chronicle">
            </div>

            <div class="mb-2">
              <label class="form-label">Issue (e.g., Q1 2025)</label>
              <input class="form-control" id="magIssue" placeholder="Quarterly — Q1 2025">
            </div>

            <div class="mb-2">
              <label class="form-label">Article Type</label>
              <select class="form-select" id="articleType">
                <option>Feature Article</option>
                <option>Event Summary</option>
                <option>Interview</option>
                <option>Student Spotlight</option>
              </select>
            </div>

            <div class="mb-2">
              <label class="form-label">Activity/Event Name</label>
              <input class="form-control" id="eventName" placeholder="Annual Tech Fest - Innovate 2025">
            </div>

            <div class="mb-2">
              <label class="form-label">Raw Input / Notes (names, dates, winners, quotes)</label>
              <textarea class="form-control" id="rawData" rows="4" placeholder="E.g., Event on Oct 5, 30 teams participated, Team TAMASHA,  Dr.Vishal Khanna quote..."></textarea>
            </div>

            <div class="mb-2">
              <label class="form-label">Upload one or more images</label>
              <input class="form-control" id="images" type="file" multiple accept="image/*">
            </div>

            <div class="mb-2">
              <label class="form-label">Primary Color (hex)</label>
              <input type="color" id="primaryColor" class="form-control form-control-color" value="#002a6c" title="Choose primary color">
            </div>

            <div class="mb-2">
              <label class="form-label">College Mascot / Accent Color (hex)</label>
              <input type="color" id="accentColor" class="form-control form-control-color" value="#f6b200" title="Accent color">
            </div>

            <div class="mb-3 d-flex gap-2">
              <button type="button" id="generateBtn" class="btn btn-primary">Generate Text</button>
              <button type="button" id="previewBtn" class="btn btn-outline-secondary">Quick Preview</button>
              <button type="button" id="exportPdfBtn" class="btn btn-success">Export PDF</button>
            </div>

            <hr>
            <h6>AI Settings</h6>
            <div class="mb-2">
              <label class="form-label">OpenAI API Key</label>
              <input class="form-control" id="openaiKey" placeholder="sk-... (optional — enter to enable AI generation)">
              <div class="form-text">No key entered? The app will generate placeholder text you can edit.</div>
            </div>

            <small class="text-muted">This is a front-end prototype — for production, proxy the API key via your own server to keep it secure.</small>
          </form>
        </div>

        <div class="mt-3">
          <div class="card p-3">
            <h5 class="mb-2">Generated Modules</h5>
            <div id="generatedOutput">
              <em class="text-muted">No output yet. Click Generate Text.</em>
            </div>
          </div>
        </div>

      </div>

      <div class="col-lg-7">
        <div class="card p-3">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h4 id="previewTitle">Magazine Preview</h4>
              <div class="small text-muted">Live preview — prints best from Export PDF</div>
            </div>
            <div>
              <span class="badge bg-secondary template-badge" id="issueBadge">Issue: —</span>
            </div>
          </div>

          <div id="magazinePreview" class="mag-preview">
            <div id="cover" class="mb-4 row gx-3">
              <div class="col-8">
                <div id="coverTitle" class="cover-title">Your Magazine Title</div>
                <div id="coverSubtitle" class="text-muted">Issue — Quarterly</div>
              </div>
              <div class="col-4 text-end">
                <img id="coverImage" src="" alt="cover" style="max-width:120px; border-radius:8px; display:none;">
              </div>
            </div>

            <div id="articleSection">
              <h5 id="articleHeading">Featured Article</h5>
              <p id="summaryThin" class="text-muted"></p>
              <p id="summaryThick" class="fw-semibold"></p>

              <div class="row">
                <div class="col-md-6">
                  <img id="articleImagePreview" class="article-image mb-2" src="" style="display:none;" alt="article image">
                </div>
                <div class="col-md-6">
                  <div id="mainBodyText"></div>
                </div>
              </div>

              <div class="mt-3">
                <div id="pullQuote" class="pull-quote text-end fst-italic"></div>
                <div id="captions" class="mt-2 small text-muted"></div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Utility: create prompt using user's input (based on the prompt structure you provided earlier)
    function buildPrompt(data) {
      return `Act as a professional Magazine Feature Writer and Editor for a college publication titled '${data.magTitle || 'The Campus Chronicle'}'.\n\n` +
        `Generate a concise 2-paragraph summary (first "thick" paragraph and second "thin" concluding paragraph), a 400-word feature article, two short photo captions, and one bold impactful pull-quote. Use an upbeat, encouraging, and professional tone. Include any raw facts provided below and adapt names/dates as given.\n\n` +
        `Event: ${data.eventName}\nRaw: ${data.rawData}\nArticle type: ${data.articleType}\nIssue: ${data.magIssue}\n\n` +
        `Format your output in JSON with keys: summary_thick, summary_thin, main_body, pull_quote, caption1, caption2.\n`;
    }

    async function callOpenAI(prompt, apiKey) {
      const url = 'https://api.openai.com/v1/chat/completions';
      const body = {
        model: 'gpt-4o-mini',
        messages: [{ role: 'user', content: prompt }],
        temperature: 0.7,
        max_tokens: 800,
      };

      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + apiKey },
        body: JSON.stringify(body)
      });
      if (!res.ok) {
        const text = await res.text();
        throw new Error('OpenAI error: ' + res.status + ' — ' + text);
      }
      const j = await res.json();
      // The assistant may return plain text; attempt to parse JSON out of the response content.
      const content = j.choices?.[0]?.message?.content || '';
      try {
        return JSON.parse(content);
      } catch (e) {
        // If not JSON, attempt to extract JSON substring.
        const match = content.match(/\{[\s\S]*\}/m);
        if (match) return JSON.parse(match[0]);
        // fallback: return raw text placed into main_body
        return { summary_thick: '', summary_thin: '', main_body: content, pull_quote: '', caption1: '', caption2: '' };
      }
    }

    // Generate placeholder content when no API key is present
    function placeholderGeneration(data) {
      const thick = `${data.eventName || 'A memorable college event'} brought together students, faculty, and visiting experts to celebrate creativity and collaboration. Held during ${data.magIssue || 'this quarter'}, the event showcased multiple student projects and competitive highlights. The atmosphere combined professional rigor and playful experimentation.`;
      const thin = `Looking forward, the college plans to build on this momentum with more hands-on workshops and student-led showcases.`;
      const main = `${thick} \n\nOrganizers worked for weeks to plan logistics, secure sponsorship, and schedule panels. Student volunteers coordinated registration and judging, ensuring smooth execution. The winning teams, including Team Tamasha, demonstrated innovative solutions to real problems, Dr. Vishal emphasized the importance of interdisciplinary learning. The event's hands-on nature gave students the chance to present ideas to industry mentors, leading to several internship opportunities and new collaborations.`;
      const pull = `"This event proves our students' ,creativity and thiniking out of box and VERSION SPACE LEARNING" said Dr.Vishal Khanna.`;
      const c1 = `Team Alpha celebrates on stage after receiving the trophy.`;
      const c2 = `Student prototype showcased at the event — a crowd favorite.`;
      return { summary_thick: thick, summary_thin: thin, main_body: main, pull_quote: pull, caption1: c1, caption2: c2 };
    }

    function readImages(files) {
      return Promise.all(Array.from(files).map(f => new Promise((res, rej) => {
        const reader = new FileReader();
        reader.onload = e => res({ name: f.name, dataUrl: e.target.result });
        reader.onerror = rej;
        reader.readAsDataURL(f);
      })));
    }

    document.getElementById('generateBtn').addEventListener('click', async () => {
      const magTitle = document.getElementById('magTitle').value.trim() || 'The Campus Chronicle';
      const magIssue = document.getElementById('magIssue').value.trim() || 'Q1';
      const eventName = document.getElementById('eventName').value.trim() || 'College Event';
      const rawData = document.getElementById('rawData').value.trim() || '';
      const articleType = document.getElementById('articleType').value;
      const apiKey = document.getElementById('openaiKey').value.trim();

      const formData = { magTitle, magIssue, eventName, rawData, articleType };
      const prompt = buildPrompt(formData);

      document.getElementById('generatedOutput').innerHTML = '<div class="spinner-border spinner-border-sm text-primary" role="status"></div> Generating...';

      try {
        let result;
        if (apiKey) {
          result = await callOpenAI(prompt, apiKey);
        } else {
          result = placeholderGeneration(formData);
        }

        // Save generated text to the UI
        const out = document.getElementById('generatedOutput');
        out.innerHTML = `<pre style="white-space:pre-wrap">${JSON.stringify(result, null, 2)}</pre>`;

        // Update preview
        document.getElementById('previewTitle').textContent = magTitle;
        document.getElementById('issueBadge').textContent = 'Issue: ' + magIssue;
        document.getElementById('coverTitle').textContent = magTitle;
        document.getElementById('coverSubtitle').textContent = magIssue;
        document.getElementById('articleHeading').textContent = (articleType || 'Featured Article') + ' — ' + eventName;
        document.getElementById('summaryThick').textContent = result.summary_thick || '';
        document.getElementById('summaryThin').textContent = result.summary_thin || '';
        document.getElementById('mainBodyText').textContent = result.main_body || '';
        document.getElementById('pullQuote').textContent = result.pull_quote || '';
        document.getElementById('captions').innerHTML = (result.caption1? ('Photo: ' + result.caption1 + '<br>') : '') + (result.caption2? ('Photo: ' + result.caption2) : '');

        // color styling
        document.getElementById('magazinePreview').style.color = document.getElementById('primaryColor').value;
        document.getElementById('pullQuote').style.color = document.getElementById('accentColor').value;

        // handle images
        const imageFiles = document.getElementById('images').files;
        if (imageFiles && imageFiles.length) {
          const imgs = await readImages(imageFiles);
          const first = imgs[0];
          document.getElementById('articleImagePreview').src = first.dataUrl;
          document.getElementById('articleImagePreview').style.display = 'block';
          document.getElementById('coverImage').src = imgs.length > 1 ? imgs[1].dataUrl : first.dataUrl;
          document.getElementById('coverImage').style.display = 'block';
        }

      } catch (e) {
        document.getElementById('generatedOutput').innerHTML = `<div class="text-danger">Error: ${e.message}</div>`;
      }
    });

    document.getElementById('previewBtn').addEventListener('click', () => {
      // Quick preview: use whatever generated output exists
      const title = document.getElementById('magTitle').value || 'Magazine';
      const issue = document.getElementById('magIssue').value || 'Issue';
      document.getElementById('previewTitle').textContent = title;
      document.getElementById('issueBadge').textContent = 'Issue: ' + issue;
    });

    document.getElementById('exportPdfBtn').addEventListener('click', async () => {
      const preview = document.getElementById('magazinePreview');
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'pt', 'a4');
      const scale = 2;
      await html2canvas(preview, { scale: scale }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const imgProps = { width: doc.internal.pageSize.getWidth(), height: (canvas.height * doc.internal.pageSize.getWidth()) / canvas.width };
        doc.addImage(imgData, 'PNG', 0, 0, imgProps.width, imgProps.height);
        doc.save((document.getElementById('magTitle').value || 'magazine') + '.pdf');
      }).catch(e => alert('Export error: ' + e.message));
    });

  </script>
</body>
</html>
